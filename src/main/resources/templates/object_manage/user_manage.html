<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/layui/css/layui.css}" rel="stylesheet" />
    <link th:href="@{/main.css}" rel="stylesheet" />
    <title>关于</title>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div th:include="header.html :: header"></div>
    <div th:include="left.html :: left"></div>
    <div class="layui-body layui-tab-content site-demo site-demo-body">
        <div class="layui-tab-item layui-show">
            <div class="layui-main">
                <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
                    <legend>用户管理</legend>
                </fieldset>

                <div class="layui-btn-group userTable">
                    <button class="layui-btn" data-type="getCheckData">获取选中行数据</button>
                    <button class="layui-btn" data-type="getCheckLength">获取选中数目</button>
                    <button class="layui-btn" data-type="isAll">验证是否全选</button>
                </div>

                <table id="user-list" lay-filter="user" lay-data="id:'userId'}"></table>

                <script type="text/html" id="user-tool-bar">
                    <div class="layui-btn-container">
                        <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="relation" href="#">
                            <i class="layui-icon layui-icon-chart" style="font-size: 10px;"></i>
                        </a>
                        <a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
                        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
                    </div>
                </script>

            </div>
        </div>
    </div>
    <div th:include="footer.html :: footer"></div>
</div>
<script th:src="@{/layui/layui.js}"></script>
<script th:inline="none" >
    //JavaScript代码区域
    layui.use(['element', 'table'], function() {
        var element = layui.element,
            table = layui.table;

        table.render({
            elem: '#user-list',
            url: '/user-demo.json',
            toolbar: false,
            title: true,
            cols: [[
                {type:'checkbox', fixed: 'left'},
                {field:'id', title:'ID', width:80, fixed: 'left', unresize: true, sort: true, totalRowText: '合计行'},
                {field:'username', title:'用户名', width:120, edit: 'text'},
                {field:'email', title:'邮箱', width:150, edit: 'text'},
                {field:'experience', title:'积分', width:100, sort: true, totalRow: true},
                {field:'sex', title:'性别', width:80, edit: 'text', sort: true},
                {field:'logins', title:'登入次数', width:100, sort: true, totalRow: true},
                {field:'sign', title:'签名'},
                {field:'city', title:'城市', width:100},
                {field:'ip', title:'IP', width:120},
                {field:'joinTime', title:'加入时间', width:120},
                {fixed: 'right', width:140, align:'center', toolbar: '#user-tool-bar'}
            ]],
            id:'userId',
            totalRow: true,
            page: true,
            response: {
                statusCode: 200
            },
            parseData: function (res) {
                return {
                    "code": res.status, //解析接口状态
                    "msg": res.message, //解析提示文本
                    "count": res.total, //解析数据长度
                    "data": res.rows.item //解析数据列表
                };
            }
        });

        //监听表格复选框选择
        table.on('checkbox(user)', function(obj){
            console.log(obj)
        });
        //监听工具条
        table.on('tool(user)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.alert('<pre class="layui-code">'+JSON.stringify(data, null, '\t')+"</pre>")
            } else if(obj.event === 'delete'){
                layer.confirm('真的删除行么', function(index){
                    obj.del();
                    layer.close(index);
                });
            } else if(obj.event === 'relation'){
                layer.open({
                    type: 2,
                    maxmin: true,
                    shadeClose: true, //点击遮罩关闭层
                    area : ['800px' , '520px'],
                    content: '/manage/relation/user?userId='+data.id
                });
            }
        });

        var $ = layui.$, active = {
            getCheckData: function(){ //获取选中数据
                var checkStatus = table.checkStatus('userId')
                    ,data = checkStatus.data;
                layer.alert(JSON.stringify(data));
            }
            ,getCheckLength: function(){ //获取选中数目
                var checkStatus = table.checkStatus('userId')
                    ,data = checkStatus.data;
                layer.msg('选中了：'+ data.length + ' 个');
            }
            ,isAll: function(){ //验证是否全选
                var checkStatus = table.checkStatus('userId');
                layer.msg(checkStatus.isAll ? '全选': '未全选')
            }
        };

        $('.userTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });
</script>
</body>
</html>